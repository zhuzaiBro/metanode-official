name: Deploy to Qiniu Cloud Staging

on:
  push:
    branches:
      - staging
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Install qshell
        run: |
          wget -q https://github.com/qiniu/qshell/releases/download/v2.16.1/qshell-v2.16.1-linux-amd64.tar.gz
          tar -xzf qshell-v2.16.1-linux-amd64.tar.gz
          chmod +x qshell
          sudo mv qshell /usr/local/bin/
          rm -rf qshell-v2.16.1-linux-amd64.tar.gz
          export PATH=$PATH:/usr/local/bin
      
      - name: Upload files to Qiniu
        env:
          QINIU_ACCESS_KEY: ${{ secrets.QINIU_ACCESS_KEY }}
          QINIU_SECRET_KEY: ${{ secrets.QINIU_SECRET_KEY }}
          QINIU_BUCKET: ${{ secrets.QINIU_BUCKET }}
        run: |
          qshell account pCRn0GGvIoR6FbZChjcK_nR6Z4LcK35mN3nWrITK avnFViTMQE7JmkonEDGkNnLsgptFlLjEIpiYxhms metanode-staging
          qshell buckets
          qshell qupload2 --src-dir=./ --bucket=metanode-staging --key-prefix="" --overwrite=true 
          
      

